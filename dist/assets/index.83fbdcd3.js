import{c as M,u as Q,a as z,d as C,r as v,o as F,b as U,w as _,e,f as J,E as G,g as q,h as w,i,j,k as S,t as $,F as A,l as x,m as B,n as O,p as k,q as P,s as m,v as H,x as I,y as W,z as X,A as Y,B as Z,C as ee,D as te,G as se,H as oe,I as ae,J as ne,K as le,L as ue,M as ie}from"./vendor.4e0cfbed.js";const re=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function u(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerpolicy&&(r.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?r.credentials="include":t.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(t){if(t.ep)return;t.ep=!0;const r=u(t);fetch(t.href,r)}};re();const K=Symbol(),L=()=>Q(K),de={selectedSite:1},ce={updateSelectedSite(d,l){d.selectedSite=l}},pe=M({state:de,mutations:ce}),ve="/api",V=z.create({baseURL:ve}),me=(d,l)=>V.post("/sign",void 0,{params:{site:d,id:l}}).then(u=>u.data),_e=async d=>(await V.post("/new_qrcode",void 0,{params:{id:d}})).data,fe=()=>V.get("/signs").then(d=>d.data);function T(d,l){if(l===void 0)if(typeof d=="number"){const u=d;return V.get("/query",{params:{id:u}}).then(a=>a.data)}else{const u=d;return V.get("/query",{params:{ojUsername:u}}).then(a=>a.data)}else{const u=d,a=l;return V.get("/query",{params:{site:u,seat:a}}).then(t=>t.data)}}function Fe(d,l,u,a){return V.post("/update",void 0,{params:{id:d,seat:l,name:u,note:a}}).then(t=>t.data)}const ge={class:"text-center"},ye=e("h2",{class:"text-xl text-green-600 font-bold"},"\u7B7E\u5230\u6210\u529F\uFF01",-1),he={class:"my-4"},Ee=e("span",{class:"text-gray-500"},"\u8BF7\u626B\u7801\u83B7\u53D6\u8D26\u53F7\u4FE1\u606F\uFF1A",-1),be=["src"],De=C({setup(d,{expose:l}){const u=v(!1),a=v(),t=async c=>{c=new URL("/qrcode/"+c,window.origin).toString(),u.value=!0,a.value=await r(c)};async function r(c){const n=document.createElement("canvas");return await J.toCanvas(n,c,{margin:0,width:400}),n.toDataURL("image/png").replace("image/png","image/octet-stream")}return l({open:t}),(c,n)=>{const s=G;return F(),U(s,{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=y=>u.value=y),width:"40rem","destroy-on-close":""},{default:_(()=>[e("div",ge,[ye,e("div",he,[Ee,e("img",{class:"mt-2 w-60 mx-auto",src:a.value},null,8,be)])])]),_:1},8,["modelValue"])}}}),$e={class:"flex space-x-4"},we=x("\u6E05\u9664"),xe=x("\u7B7E\u5230"),Be={key:0},Ve={class:"mt-4 space-y-4"},Ce={class:"grid grid-cols-3 gap-4"},Ue={class:"info-container"},Se=e("span",{class:"info-label"},"\u59D3\u540D",-1),je={class:"info-value"},Ae={class:"info-container"},ke=e("span",{class:"info-label"},"\u5B66\u53F7",-1),Ie={class:"info-value"},qe={class:"info-container"},Le=e("span",{class:"info-label"},"\u5EA7\u4F4D\u53F7",-1),Te={class:"info-value"},Re={class:"grid grid-cols-2 gap-4"},Oe={class:"info-container"},Pe=e("span",{class:"info-label"},"\u8D26\u53F7",-1),Ke={class:"info-value"},Ne={class:"info-container"},Me=e("span",{class:"info-label"},"\u5BC6\u7801",-1),Qe={class:"info-value"},ze={class:"mt-4 flex justify-between"},Je=e("div",{class:"flex items-center space-x-2 text-gray-400 text-sm"},[e("span",{class:"iconfont icon-warning"}),e("p",null,"\u8BF7\u59A5\u5584\u4FDD\u7BA1\u8D26\u53F7\u4FE1\u606F\uFF0C\u4EE5\u9632\u5BF9\u5916\u6CC4\u9732\u3002")],-1),Ge={key:0,class:"text-gray-400 mr-2"},He=x("\u751F\u6210\u4E8C\u7EF4\u7801"),We=C({setup(d){const l=v(""),u=v(!1),a=v(!1),t=v(null),r=L(),c=q(()=>r.state.selectedSite),n=v({id:0,name:"",ojUsername:"",ojPassword:"",seat:0,site:0}),s=async()=>{if(l.value.trim().length!==0){a.value=a.value&&!a.value,u.value=!0;try{const f=await me(c.value,parseInt(l.value,10));n.value=f,a.value=!0,f.qrcode?t.value.open(f.qrcode):B({type:"success",message:"\u83B7\u53D6\u6210\u529F\uFF01",duration:2e3})}catch(f){console.error(f),B({type:"error",message:"\u83B7\u53D6\u5931\u8D25\uFF01",duration:2e3})}finally{u.value=!1}}},y=()=>{_e(n.value.id).then(({qrcode:f})=>{n.value.qrcode=f,t.value.open(f)})},h=()=>{a.value=!1,l.value=""};return(f,E)=>{const b=O,o=k;return F(),w(A,null,[i(De,{ref:(g,D)=>{D.qrcodeDialog=g,t.value=g}},null,512),e("div",$e,[i(b,{onKeyup:E[0]||(E[0]=j(g=>s(),["enter"])),type:"number",modelValue:l.value,"onUpdate:modelValue":E[1]||(E[1]=g=>l.value=g),placeholder:"\u8F93\u5165\u5B66\u53F7..."},null,8,["modelValue"]),a.value?(F(),U(o,{key:0,onClick:h,icon:"iconfont icon-reset"},{default:_(()=>[we]),_:1})):S("",!0),i(o,{onClick:E[2]||(E[2]=g=>s()),loading:u.value,type:"primary"},{default:_(()=>[xe]),_:1},8,["loading"])]),a.value?(F(),w("div",Be,[e("div",Ve,[e("div",Ce,[e("div",Ue,[Se,e("div",je,$(n.value.name),1)]),e("div",Ae,[ke,e("div",Ie,$(n.value.id),1)]),e("div",qe,[Le,e("div",Te,$(n.value.seat),1)])]),e("div",Re,[e("div",Oe,[Pe,e("div",Ke,$(n.value.ojUsername),1)]),e("div",Ne,[Me,e("div",Qe,$(n.value.ojPassword),1)])])]),e("div",ze,[Je,e("div",null,[n.value.qrcode?S("",!0):(F(),w("span",Ge," (\u4E8C\u7EF4\u7801\u5DF2\u4F7F\u7528) ")),i(o,{onClick:y},{default:_(()=>[He]),_:1})])])])):S("",!0)],64)}}}),Xe={class:"info-container relative"},Ye={class:"info-label"},Ze=["value","type"],R=C({props:{modelValue:null,label:null},emits:["update:modelValue"],setup(d,{emit:l}){const u=d,a=n=>{const s=n.target.value;l("update:modelValue",s)},{label:t,modelValue:r}=P(u),c=v(typeof r.value);return(n,s)=>(F(),w("div",Xe,[e("span",Ye,$(m(t)),1),e("input",{value:m(r),onInput:s[0]||(s[0]=y=>a(y)),type:{string:"text",number:"number"}[m(c)],class:"info-value w-32 outline-none"},null,40,Ze)]))}}),et={class:"flex space-x-4"},tt={class:"flex flex-grow items-center"},st=e("span",{class:"mx-3"},"or",-1),ot=e("span",{class:"mx-3"},"or",-1),at=x("\u67E5\u8BE2"),nt={key:0},lt={class:"mt-4 space-y-4"},ut={class:"grid grid-cols-3 gap-4"},it={class:"info-container"},rt=e("span",{class:"info-label"},"\u5B66\u53F7",-1),dt={class:"info-value"},ct={class:"grid grid-cols-3 gap-4"},pt={class:"info-container"},vt=e("span",{class:"info-label"},"\u8D26\u53F7",-1),mt={class:"info-value"},_t={class:"info-container"},ft=e("span",{class:"info-label"},"\u5BC6\u7801",-1),Ft={class:"info-value"},gt={class:"mt-4 flex justify-between"},yt=e("div",{class:"flex items-center space-x-2 text-gray-400 text-sm"},[e("span",{class:"iconfont icon-warning"}),e("p",null,"\u70B9\u51FB\u59D3\u540D\u3001\u5EA7\u4F4D\u53F7\u7684\u6587\u5B57\u53EF\u4EE5\u5BF9\u5176\u8FDB\u884C\u7F16\u8F91\u3002")],-1),ht=x("\u91CD\u7F6E"),Et=x("\u4FDD\u5B58\u66F4\u6539"),bt=C({setup(d){const l=v(!1),u=v(!1),a=v(!1),t=H({id:"",seat:"",ojUsername:""}),r=L(),c=q(()=>r.state.selectedSite);let n={id:0,name:"",ojUsername:"",ojPassword:"",seat:0,site:0,note:""};const s=v(I.exports.clone(n)),y=q(()=>I.exports.isEqual(n,s.value)),h=async()=>{const b=t.id.trim().length!==0,o=t.seat.trim().length!==0,g=t.ojUsername.trim().length!==0;if(!(!b&&!o&&!g)){a.value=a.value&&!a.value,u.value=!0;try{const D=b?await T(parseInt(t.id,10)):o?await T(c.value,parseInt(t.seat,10)):await T(t.ojUsername);s.value=I.exports.clone(D),n=D,a.value=!0,B({type:"success",message:"\u83B7\u53D6\u6210\u529F\uFF01",duration:2e3})}catch{B({type:"error",message:"\u83B7\u53D6\u5931\u8D25\uFF01",duration:2e3})}finally{u.value=!1}}},f=async()=>{if(l.value=!0,[s.value.name,s.value.id,s.value.seat].every(b=>I.exports.isEmpty(b))){debugger;B({type:"error",message:"\u5B57\u6BB5\u4E0D\u80FD\u4E3A\u7A7A",duration:2e3}),l.value=!1;return}try{await Fe(s.value.id,s.value.seat,s.value.name,s.value.note),B({type:"success",message:"\u4FDD\u5B58\u6210\u529F\uFF01",duration:2e3})}catch{B({type:"error",message:"\u4FDD\u5B58\u5931\u8D25",duration:2e3})}finally{l.value=!1}},E=()=>{a.value=!1,t.id="",t.seat=""};return(b,o)=>{const g=O,D=k;return F(),w(A,null,[e("div",et,[e("div",tt,[i(g,{onKeyup:o[0]||(o[0]=j(p=>h(),["enter"])),onFocus:o[1]||(o[1]=p=>m(t).seat=m(t).ojUsername=""),modelValue:m(t).id,"onUpdate:modelValue":o[2]||(o[2]=p=>m(t).id=p),placeholder:"\u5B66\u53F7..."},null,8,["modelValue"]),st,i(g,{onFocus:o[3]||(o[3]=p=>m(t).id=m(t).ojUsername=""),onKeyup:o[4]||(o[4]=j(p=>h(),["enter"])),modelValue:m(t).seat,"onUpdate:modelValue":o[5]||(o[5]=p=>m(t).seat=p),placeholder:"\u5EA7\u4F4D..."},null,8,["modelValue"]),ot,i(g,{onFocus:o[6]||(o[6]=p=>m(t).id=m(t).seat=""),onKeyup:o[7]||(o[7]=j(p=>h(),["enter"])),modelValue:m(t).ojUsername,"onUpdate:modelValue":o[8]||(o[8]=p=>m(t).ojUsername=p),placeholder:"OJ\u8D26\u53F7..."},null,8,["modelValue"])]),i(D,{onClick:o[9]||(o[9]=p=>h()),loading:u.value,type:"primary"},{default:_(()=>[at]),_:1},8,["loading"])]),a.value?(F(),w("div",nt,[e("div",lt,[e("div",ut,[i(R,{label:"\u59D3\u540D",modelValue:s.value.name,"onUpdate:modelValue":o[10]||(o[10]=p=>s.value.name=p)},null,8,["modelValue"]),e("div",it,[rt,e("div",dt,$(s.value.id),1)]),i(R,{label:"\u5EA7\u4F4D\u53F7",modelValue:s.value.seat,"onUpdate:modelValue":o[11]||(o[11]=p=>s.value.seat=p)},null,8,["modelValue"])]),e("div",ct,[e("div",pt,[vt,e("div",mt,$(s.value.ojUsername),1)]),e("div",_t,[ft,e("div",Ft,$(s.value.ojPassword),1)]),i(R,{label:"\u5907\u6CE8",modelValue:s.value.note,"onUpdate:modelValue":o[12]||(o[12]=p=>s.value.note=p)},null,8,["modelValue"])])]),e("div",gt,[yt,e("div",null,[i(D,{onClick:E,icon:"iconfont icon-reset"},{default:_(()=>[ht]),_:1}),i(D,{loading:l.value,onClick:o[13]||(o[13]=p=>f()),type:"primary",disabled:m(y)},{default:_(()=>[Et]),_:1},8,["loading","disabled"])])])])):S("",!0)],64)}}});const Dt=x("\u5BFC\u51FA CSV"),$t=C({props:{modelValue:null},setup(d){const l=d,u=v(void 0),{modelValue:a}=P(l);W(async()=>{if(a.value)try{const r=await fe();u.value=r}catch{B.error("\u83B7\u53D6\u5217\u8868\u4FE1\u606F\u5931\u8D25\uFF01")}});const t=()=>{if(u.value){const r=`\u5B66\u53F7, \u59D3\u540D, \u8D26\u53F7, \u8003\u573A, \u5EA7\u4F4D, \u65F6\u95F4, \u5907\u6CE8
`,c=u.value.map(s=>[s.id,s.name,s.ojUsername,s.site,s.seat,s.time,s.note].join()).join(`
`),n=document.createElement("a");n.href="data:text/csv;charset=utf-8,"+encodeURIComponent("\uFEFF"+r+c),n.target="_blank",n.download="\u8003\u751F\u540D\u5355.csv",n.click()}};return(r,c)=>{const n=k,s=X,y=Y,h=Z,f=ee;return F(),U(f,{"custom-class":" h-screen",size:"50%","model-value":m(a),onClose:c[0]||(c[0]=E=>r.$emit("update:modelValue",!1)),title:"\u672C\u573A\u8003\u751F",direction:"rtl"},{default:_(()=>[i(n,{onClick:t},{default:_(()=>[Dt]),_:1}),i(h,{"max-height":"calc(100% - 40px)"},{default:_(()=>[i(y,{data:u.value,style:{width:"100%"}},{default:_(()=>[i(s,{prop:"id",label:"\u5B66\u53F7",width:"120"}),i(s,{prop:"name",label:"\u59D3\u540D",width:"150"}),i(s,{prop:"ojUsername",label:"\u8D26\u53F7",width:"100"}),i(s,{prop:"site",label:"\u8003\u573A",width:"50"}),i(s,{prop:"seat",label:"\u5EA7\u4F4D",width:"50"}),i(s,{prop:"time",label:"\u65F6\u95F4",width:"160"}),i(s,{prop:"note",label:"\u5907\u6CE8",width:"150"})]),_:1},8,["data"])]),_:1})]),_:1},8,["model-value"])}}});const wt={class:"flex flex-col items-center justify-center h-screen"},xt={class:"flex items-center justify-between"},Bt=e("span",null,"\u8F6F\u4EF6\u90E8\u8003\u6838\u673A\u8BD5\u8D26\u53F7\u5DE5\u5177",-1),Vt={class:"flex items-center space-x-4"},Ct={class:"relative w-32"},Ut=x("\u67E5\u770B\u672C\u573A\u8003\u751F"),St=C({setup(d){const l=v("get"),u=v(!1),a=v(1),t=v([{value:1,label:"02301"},{value:2,label:"02304"}]),r=L();return te(a,()=>{r.commit("updateSelectedSite",a.value)}),(c,n)=>{const s=se,y=oe,h=ae,f=k,E=ne,b=le;return F(),w(A,null,[e("div",wt,[i(b,{class:"w-[44rem]"},{header:_(()=>[e("div",xt,[Bt,e("div",Vt,[e("div",Ct,[i(y,{class:"absolute -translate-y-1/2",modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=o=>a.value=o)},{default:_(()=>[(F(!0),w(A,null,ue(t.value,o=>(F(),U(s,{key:o.value,value:o.value,label:o.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])])]),default:_(()=>[i(E,{class:"relative",modelValue:l.value,"onUpdate:modelValue":n[2]||(n[2]=o=>l.value=o)},{default:_(()=>[i(h,{label:"\u83B7\u53D6",name:"get"}),i(h,{label:"\u67E5\u8BE2",name:"query"}),i(f,{onClick:n[1]||(n[1]=o=>u.value=!0),class:"absolute top-0 right-0",type:"text"},{default:_(()=>[Ut]),_:1})]),_:1},8,["modelValue"]),l.value==="get"?(F(),U(We,{key:0})):S("",!0),l.value==="query"?(F(),U(bt,{key:1})):S("",!0)]),_:1})]),i($t,{modelValue:u.value,"onUpdate:modelValue":n[3]||(n[3]=o=>u.value=o)},null,8,["modelValue"])],64)}}});const N=ie(St);N.use(pe,K);N.mount("#app");
